--------------------------------------------------------
--  DDL for Procedure INVENTORY_MANAGEMENT
--------------------------------------------------------
set define off;

  CREATE OR REPLACE PROCEDURE "PIZZA"."INVENTORY_MANAGEMENT" (
    P_PIZZA_ID     IN NUMBER,
    P_PIZZA_AMOUNT IN NUMBER)
AS
  CURSOR ING_CURSOR -- FIND THE INGREDIENTS FOR THE PIZZA
  IS
    SELECT i.ID ,
      i.AMOUNT ,
      i.EXTRAPRICE ,
      i.MEASUREMENTTYPE ,
      i.NAME
    FROM INGREDIENT i
    WHERE i.ID IN
      (SELECT DISTINCT p.INGREDIENTS_ID
      FROM PIZZA_INGREDIENT p
      WHERE p.PIZZA_ID = P_PIZZA_ID
      );
  ING_RECORD INGREDIENT%ROWTYPE;
  INGREDIENT_AMOUNT NUMBER;
  UPDATE_INV_RESPONSE NUMBER;
BEGIN
  OPEN ING_CURSOR;
  LOOP -- LOOP THROUGH ALL THE INGREDIENTS
    FETCH ING_CURSOR INTO ING_RECORD;
    EXIT WHEN ING_CURSOR%NOTFOUND;

     -- SAVE THE AMOUNTS OF EACH INGREDIENT MULTIPLIED BY PIZZA_AMOUNT
    INGREDIENT_AMOUNT := ING_RECORD.AMOUNT * P_PIZZA_AMOUNT;

    -- WRITE TO PURCHASE ORDER TABLE
    UPDATE_INV_RESPONSE := UPDATE_INVENTORY(ING_RECORD.ID, INGREDIENT_AMOUNT);
  END LOOP;
END INVENTORY_MANAGEMENT;

/